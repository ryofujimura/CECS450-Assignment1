<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
<div id="chart"></div>

<script>
const svg = d3.select("#chart")
  .append("svg")
  .attr("width", 800)
  .attr("height", 400);

fetch('Motor_Vehicle_Collisions_2020-2024.csv')
  .then(response => response.text())
  .then(text => {
    const data = d3.csvParse(text).slice(0, 20);
    
    const vehicleCounts = d3.rollup(data, v => v.length, d => d['VEHICLE TYPE CODE 1']);
    const chartData = Array.from(vehicleCounts).map(([type, count]) => ({ type, count }));

    const pie = d3.pie().value(d => d.count).sort(null);
    const arc = d3.arc().innerRadius(0).outerRadius(150);
    const color = d3.scaleOrdinal(d3.schemeCategory10);

    const g = svg.append("g").attr("transform", "translate(400,200)");
    
    const arcs = g.selectAll("arc").data(pie(chartData)).enter().append("g");

    arcs.append("path")
      .attr("d", arc)
      .attr("fill", (d, i) => color(i))
      .transition()
      .duration(1000)
      .delay((d, i) => i * 200)
      .attrTween("d", d => {
        const interpolate = d3.interpolate({ startAngle: 0, endAngle: 0 }, d);
        return t => arc(interpolate(t));
      });

    arcs.append("text")
      .attr("transform", d => `translate(${arc.centroid(d)})`)
      .attr("text-anchor", "middle")
      .text(d => d.data.type)
      .style("opacity", 0)
      .transition()
      .duration(500)
      .delay(1000)
      .style("opacity", 1);

    svg.append("text").attr("x", 400).attr("y", 20).attr("text-anchor", "middle").text("Vehicle Types");
  });
</script>
</body>
</html>
