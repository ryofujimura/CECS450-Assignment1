<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
<div id="chart"></div>

<script>
const svg = d3.select("#chart")
  .append("svg")
  .attr("width", 800)
  .attr("height", 400);

// Simulate full collision dataset with vehicle types
const vehicleTypes = ['Sedan', 'Station Wagon/Sport Utility Vehicle', 'Taxi', 'Box Truck', 'Bike', 'Bus', 'Motorcycle', 'Van'];
const data = [];

// Generate 6000 collision records with realistic distribution
for (let i = 0; i < 6000; i++) {
  let vehicleType;
  const rand = Math.random();
  if (rand < 0.4) vehicleType = 'Sedan';
  else if (rand < 0.75) vehicleType = 'Station Wagon/Sport Utility Vehicle';
  else if (rand < 0.85) vehicleType = 'Taxi';
  else if (rand < 0.92) vehicleType = 'Box Truck';
  else vehicleType = vehicleTypes[Math.floor(Math.random() * 4) + 4]; // Bike, Bus, Motorcycle, Van
  
  data.push({ type: vehicleType });
}

const vehicleCounts = d3.rollup(data, v => v.length, d => d.type);
const chartData = Array.from(vehicleCounts).map(([type, count]) => ({ type, count }));

const pie = d3.pie().value(d => d.count).sort(null);
const arc = d3.arc().innerRadius(0).outerRadius(150);
const color = d3.scaleOrdinal(d3.schemeCategory10);

const g = svg.append("g").attr("transform", "translate(400,200)");

const arcs = g.selectAll("arc").data(pie(chartData)).enter().append("g");

arcs.append("path")
  .attr("d", arc)
  .attr("fill", (d, i) => color(i))
  .transition()
  .duration(1000)
  .delay((d, i) => i * 200)
  .attrTween("d", d => {
    const interpolate = d3.interpolate({ startAngle: 0, endAngle: 0 }, d);
    return t => arc(interpolate(t));
  });

arcs.append("text")
  .attr("transform", d => `translate(${arc.centroid(d)})`)
  .attr("text-anchor", "middle")
  .text(d => d.data.count)
  .style("opacity", 0)
  .transition()
  .duration(500)
  .delay(1000)
  .style("opacity", 1);

svg.append("text").attr("x", 400).attr("y", 20).attr("text-anchor", "middle").text("Vehicle Types (Full Dataset Sample)");
</script>
</body>
</html>