<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
<div id="chart"></div>

<script>
const svg = d3.select("#chart")
  .append("svg")
  .attr("width", 800)
  .attr("height", 400);

const csvData = `CRASH DATE,CRASH TIME,CONTRIBUTING FACTOR VEHICLE 1,VEHICLE TYPE CODE 1,MONTH,DAY,YEAR
01/01/2020,0:00,Driver Inattention/Distraction,Taxi,1,1,2020
01/01/2020,0:00,Driver Inattention/Distraction,Sedan,1,1,2020
01/01/2020,0:00,Alcohol Involvement,Sedan,1,1,2020
01/01/2020,0:00,Backing Unsafely,Sedan,1,1,2020
01/01/2020,0:00,Driver Inattention/Distraction,Sedan,1,1,2020
01/01/2020,0:10,Driver Inattention/Distraction,Sedan,1,1,2020
01/01/2020,0:15,Driver Inattention/Distraction,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,0:15,Driver Inattention/Distraction,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,0:15,Driver Inattention/Distraction,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,0:20,Driver Inattention/Distraction,Sedan,1,1,2020
01/01/2020,0:20,Other Vehicular,Sedan,1,1,2020
01/01/2020,0:22,Passing or Lane Usage Improper,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,0:25,Other Vehicular,Sedan,1,1,2020
01/01/2020,0:37,Driver Inattention/Distraction,Taxi,1,1,2020
01/01/2020,0:39,Traffic Control Disregarded,Sedan,1,1,2020
01/01/2020,0:55,Following Too Closely,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,10:00,Passing Too Closely,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,10:30,Fell Asleep,Sedan,1,1,2020
01/01/2020,11:00,Passing Too Closely,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,11:00,Driver Inattention/Distraction,Sedan,1,1,2020`;

const data = d3.csvParse(csvData);
const processedData = data.map(d => ({
  date: new Date(d['CRASH DATE']),
  factor: d['CONTRIBUTING FACTOR VEHICLE 1'],
  y: Math.random() * 300 + 50
}));

const xScale = d3.scaleTime().domain([d3.min(processedData, d => d.date), d3.max(processedData, d => d.date)]).range([50, 750]);
const yScale = d3.scaleLinear().domain([0, 400]).range([350, 50]);
const color = d3.scaleOrdinal(d3.schemeCategory10);
const factors = [...new Set(processedData.map(d => d.factor))];

processedData.forEach((d, i) => {
  setTimeout(() => {
    svg.append("circle")
      .attr("cx", xScale(d.date))
      .attr("cy", yScale(d.y))
      .attr("r", 0)
      .attr("fill", color(factors.indexOf(d.factor)))
      .transition()
      .duration(800)
      .attr("r", 8);
  }, i * 100);
});

svg.append("g").attr("transform", "translate(0,350)").call(d3.axisBottom(xScale));
svg.append("text").attr("x", 400).attr("y", 20).attr("text-anchor", "middle").text("Crash Factors Over Time");
</script>
</body>
</html>