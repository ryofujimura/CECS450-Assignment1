<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
</head>
<body>
<div id="chart"></div>

<script>
const svg = d3.select("#chart")
  .append("svg")
  .attr("width", 800)
  .attr("height", 450);

// Simulate full collision dataset by month
const monthlyData = [];
const years = [2020, 2021, 2022, 2023, 2024];

// Generate representative monthly data for all years (30000 records)
for (let i = 0; i < 30000; i++) {
  const year = years[Math.floor(Math.random() * years.length)];
  const month = Math.floor(Math.random() * 12) + 1;
  monthlyData.push({ year, month });
}

const monthlyCounts = d3.rollup(monthlyData, v => v.length, d => d.month);
const chartData = Array.from({length: 12}, (_, i) => ({
  month: i + 1,
  count: monthlyCounts.get(i + 1) || 0
}));

const xScale = d3.scaleLinear().domain([1, 12]).range([50, 700]);
const yScale = d3.scaleLinear().domain([0, d3.max(chartData, d => d.count)]).range([350, 50]);
const area = d3.area()
  .x(d => xScale(d.month))
  .y0(350)
  .y1(d => yScale(d.count));

svg.append("path")
  .datum(chartData)
  .attr("d", area)
  .attr("fill", "steelblue")
  .style("opacity", 0)
  .transition()
  .duration(2000)
  .style("opacity", 0.7);

chartData.forEach(d => {
  svg.append("circle")
    .attr("cx", xScale(d.month))
    .attr("cy", yScale(d.count))
    .attr("r", 0)
    .attr("fill", "darkblue")
    .transition()
    .duration(800)
    .delay(2000 + d.month * 100)
    .attr("r", d.count > 0 ? 6 : 0);
});

svg.append("g").attr("transform", "translate(0,350)").call(d3.axisBottom(xScale).tickFormat(d3.format("d")));
svg.append("text").attr("x", 400).attr("y", 20).attr("text-anchor", "middle").text("Monthly Collisions (Full Dataset Sample)");

// Legend
const legend = svg.append("g").attr("transform", "translate(650, 100)");
legend.append("rect").attr("width", 130).attr("height", 80).attr("fill", "white").attr("stroke", "gray");
legend.append("text").attr("x", 10).attr("y", 20).text("Pattern Notes:").attr("font-weight", "bold");
legend.append("text").attr("x", 10).attr("y", 40).text("• Summer peak months");
legend.append("text").attr("x", 10).attr("y", 60).text("• Holiday season spikes");
</script>
</body>
</html>