<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
</head>
<body>
<div id="chart"></div>

<script>
const svg = d3.select("#chart")
  .append("svg")
  .attr("width", 800)
  .attr("height", 400);

const csvData = `CRASH DATE,CRASH TIME,CONTRIBUTING FACTOR VEHICLE 1,VEHICLE TYPE CODE 1,MONTH,DAY,YEAR
01/01/2020,0:00,Driver Inattention/Distraction,Taxi,1,1,2020
01/01/2020,0:00,Driver Inattention/Distraction,Sedan,1,1,2020
01/01/2020,0:00,Alcohol Involvement,Sedan,1,1,2020
01/01/2020,0:00,Backing Unsafely,Sedan,1,1,2020
01/01/2020,0:00,Driver Inattention/Distraction,Sedan,1,1,2020
01/01/2020,0:10,Driver Inattention/Distraction,Sedan,1,1,2020
01/01/2020,0:15,Driver Inattention/Distraction,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,0:15,Driver Inattention/Distraction,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,0:15,Driver Inattention/Distraction,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,0:20,Driver Inattention/Distraction,Sedan,1,1,2020
01/01/2020,0:20,Other Vehicular,Sedan,1,1,2020
01/01/2020,0:22,Passing or Lane Usage Improper,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,0:25,Other Vehicular,Sedan,1,1,2020
01/01/2020,0:37,Driver Inattention/Distraction,Taxi,1,1,2020
01/01/2020,0:39,Traffic Control Disregarded,Sedan,1,1,2020
01/01/2020,0:55,Following Too Closely,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,10:00,Passing Too Closely,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,10:30,Fell Asleep,Sedan,1,1,2020
01/01/2020,11:00,Passing Too Closely,Station Wagon/Sport Utility Vehicle,1,1,2020
01/01/2020,11:00,Driver Inattention/Distraction,Sedan,1,1,2020`;

const data = d3.csvParse(csvData);
const monthlyData = data.map(d => ({
  month: parseInt(d['MONTH']),
 	count: 1
}));

const monthlyCounts = d3.rollup(monthlyData, v => v.length, d => d.month);
const chartData = Array.from({length: 12}, (_, i) => ({
  month: i + 1,
  count: monthlyCounts.get(i + 1) || 0
}));

const xScale = d3.scaleLinear().domain([1, 12]).range([50, 750]);
const yScale = d3.scaleLinear().domain([0, d3.max(chartData, d => d.count)]).range([350, 50]);
const area = d3.area()
  .x(d => xScale(d.month))
  .y0(350)
  .y1(d => yScale(d.count));

svg.append("path")
  .datum(chartData)
  .attr("d", area)
  .attr("fill", "steelblue")
  .style("opacity", 0)
  .transition()
  .duration(1500)
  .style("opacity", 0.7);

chartData.forEach(d => {
  svg.append("circle")
    .attr("cx", xScale(d.month))
    .attr("cy", yScale(d.count))
    .attr("r", 0)
    .attr("fill", "darkblue")
    .transition()
    .duration(500)
    .delay(1500 + d.month * 100)
    .attr("r", d.count > 0 ? 5 : 0);
});

svg.append("g").attr("transform", "translate(0,350)").call(d3.axisBottom(xScale).tickFormat(d3.format("d")));
svg.append("text").attr("x", 400).attr("y", 20).attr("text-anchor", "middle").text("Monthly Collisions");
</script>
</body>
</html>
